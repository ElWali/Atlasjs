/* Reset & Base */
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Helvetica Neue',Arial,sans-serif}
#map{height:100vh;width:100%;position:relative;overflow:hidden;background:#aad3df;cursor:grab}
#map.m-dragging{cursor:grabbing}

/* Tile Layer */
.m-tile-layer{position:absolute;inset:0;z-index:200;will-change:transform}
.m-tile{position:absolute;width:256px;height:256px;opacity:0;transition:opacity 0.2s ease;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}
.m-tile.loaded{opacity:1}
.m-tile.error{opacity:0.3;background:#e0e0e0}

/* Overlay Layers */
.m-overlay-layer{position:absolute;inset:0;z-index:400;pointer-events:none}

/* Controls */
.m-control{position:absolute;z-index:600;background:#fff;border-radius:4px;box-shadow:0 1px 5px rgba(0,0,0,0.25);pointer-events:auto}
.m-zoom-control{top:12px;right:12px;padding:4px}
.m-zoom-control button{display:block;width:32px;height:32px;border:0;background:#fff;cursor:pointer;font-size:20px;font-weight:600;color:#333;transition:background 0.15s ease;border-radius:2px;margin:2px 0}
.m-zoom-control button:hover{background:#f4f4f4}
.m-zoom-control button:active{background:#e8e8e8}
.m-zoom-control button:disabled{color:#ccc;cursor:not-allowed}
.m-zoom-control button:first-child{margin-top:0}
.m-zoom-control button:last-child{margin-bottom:0}

.m-scale-control{left:12px;bottom:12px;padding:5px 10px;font-size:11px;line-height:1.1;background:rgba(255,255,255,0.8);border-top:2px solid #444;border-left:2px solid #444;border-right:2px solid #444;border-radius:0;box-shadow:none}

.m-attribution{right:12px;bottom:12px;padding:2px 6px;font-size:10px;background:rgba(255,255,255,0.7);border-radius:2px;box-shadow:none}
.m-attribution a{color:#0078a8;text-decoration:none}
.m-attribution a:hover{text-decoration:underline}

/* Markers */
.m-marker{position:absolute;z-index:500;pointer-events:auto;cursor:pointer;transition:transform 0.1s ease;will-change:transform}
.m-marker-icon{position:relative;transform:translate(-50%,-100%)}
.m-marker-shadow{width:24px;height:24px;border-radius:50%;background:radial-gradient(circle, rgba(0,0,0,0.2) 0%, transparent 70%);position:absolute;left:50%;bottom:-4px;transform:translateX(-50%) scale(1,0.5);pointer-events:none}
.m-marker-dot{width:20px;height:20px;background:#e74c3c;border:3px solid #fff;border-radius:50%;box-shadow:0 3px 8px rgba(0,0,0,0.3);position:relative;z-index:1}
.m-marker:hover .m-marker-dot{transform:scale(1.15)}

/* Popups */
.m-popup{position:absolute;z-index:700;background:#fff;border-radius:8px;box-shadow:0 3px 14px rgba(0,0,0,0.35);padding:12px;min-width:100px;max-width:260px;font-size:13px;line-height:1.4;pointer-events:auto;animation:popupFadeIn 0.2s ease}
.m-popup::after{content:'';position:absolute;left:50%;bottom:-10px;margin-left:-10px;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #fff}
.m-popup-close{position:absolute;top:6px;right:6px;width:20px;height:20px;border:0;background:transparent;cursor:pointer;font-size:18px;line-height:1;color:#999;padding:0}
.m-popup-close:hover{color:#333}
.m-popup-content{margin:0}
.m-popup-content strong{color:#333}
@keyframes popupFadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* Search Control */
.m-search-control{position:absolute;top:12px;left:50%;transform:translateX(-50%);z-index:600;background:#fff;border-radius:4px;box-shadow:0 1px 5px rgba(0,0,0,0.25);display:flex;align-items:center}
.m-search-control input{border:0;border-radius:4px 0 0 4px;padding:8px 12px;width:240px;font-size:14px;outline:0}
.m-search-control button{border:0;border-radius:0 4px 4px 0;background:#fff;cursor:pointer;padding:8px 12px;font-size:16px;color:#333;transition:background 0.15s ease}
.m-search-control button:hover{background:#f4f4f4}

/* Drawing Controls */
.m-draw-control{position:absolute;top:56px;right:12px;z-index:600;background:#fff;border-radius:4px;box-shadow:0 1px 5px rgba(0,0,0,0.25);padding:4px}
.m-draw-control button{display:block;width:32px;height:32px;border:0;background:#fff;cursor:pointer;font-size:16px;color:#333;transition:background 0.15s ease;border-radius:2px;margin:2px 0;text-align:center}
.m-draw-control button:hover{background:#f4f4f4}
.m-draw-control button.active{background:#e3f2fd;color:#1976d2}

/* Drawing Tools */
.m-draw-line{stroke:#3388ff;stroke-width:3;fill:none;cursor:crosshair}
.m-draw-circle{stroke:#3388ff;stroke-width:2;fill:#3388ff;fill-opacity:0.2;cursor:crosshair}
.m-draw-rectangle{stroke:#3388ff;stroke-width:2;fill:#3388ff;fill-opacity:0.2;cursor:crosshair}
.m-draw-marker{fill:#e74c3c;stroke:#fff;stroke-width:2;cursor:crosshair}

/* Loading Indicator */
.m-loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:800;background:rgba(255,255,255,0.95);padding:16px 24px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.15);font-size:14px;color:#666;pointer-events:none}

/* Accessibility */
.m-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Layer Control */
.m-layer-control{display:flex;gap:5px}
.m-layer-control button{padding:8px 12px;border:1px solid #ccc;background:#fff;cursor:pointer;border-radius:4px;font-family:inherit;font-size:12px}
.m-layer-control button:hover{background:#f4f4f4}
.m-layer-control button.active{background:#e3f2fd;color:#1976d2;border-color:#1976d2}